(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d83fa7a0"],{"111c":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("bs-container",[t("bs-header",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("\n      调度日志\n    ")]},proxy:!0}])},[e._v(" "),t("yh-button",{attrs:{type:"primary"},on:{click:e.handleClear}},[e._v("\n      清理\n    ")])],1),e._v(" "),t("bs-body",[t("bs-table-mix",{attrs:{"fixed-height":""},scopedSlots:e._u([{key:"default",fn:function(a){var l=a._tableHeight;return[t("yh-table",{directives:[{name:"loading",rawName:"v-loading.lock",value:e.loadingFlag,expression:"loadingFlag",modifiers:{lock:!0}}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",data:e.tableData,height:l,stripe:"","all-border":""}},[t("yh-table-column",{attrs:{label:"任务ID",prop:"jobId",width:"120"}}),e._v(" "),t("yh-table-column",{attrs:{label:"任务描述",prop:"jobDesc"}}),e._v(" "),t("yh-table-column",{attrs:{label:"AppName",prop:"appName"}}),e._v(" "),t("yh-table-column",{attrs:{label:"调度时间",prop:"triggerTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(e._f("formateTime")(t.row.triggerTime))+"\n            ")]}}],null,!0)}),e._v(" "),t("yh-table-column",{attrs:{label:"调度结果",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:["triggerCode","triggerCode-".concat(a.row.triggerCode)]},[e._v("\n                "+e._s(e.getTriggerResult(a.row.triggerCode))+"\n              ")])]}}],null,!0)}),e._v(" "),t("yh-table-column",{attrs:{label:"调度备注",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.triggerMsg?t("yh-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleView(a.row.triggerMsg)}}},[e._v("\n                查看\n              ")]):t("span",[e._v("无")])]}}],null,!0)}),e._v(" "),t("yh-table-column",{attrs:{label:"执行时间",prop:"handleTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(e._f("formateTime")(t.row.handleTime))+"\n            ")]}}],null,!0)}),e._v(" "),t("yh-table-column",{attrs:{label:"执行结果",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:["triggerCode","triggerCode-".concat(a.row.handleCode)]},[e._v("\n                "+e._s(e.getHandleResult(a.row.handleCode))+"\n              ")])]}}],null,!0)}),e._v(" "),t("yh-table-column",{attrs:{label:"执行备注",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.handleMsg?t("yh-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleView(a.row.handleMsg)}}},[e._v("\n                查看\n              ")]):t("span",[e._v("无")])]}}],null,!0)}),e._v(" "),t("yh-table-column",{attrs:{width:"110",label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[200===a.row.triggerCode||0!==a.row.handleCode?t("div",[0===a.row.handleCode?t("yh-button",{staticClass:"fe-btn-delete",attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleStop(a.row)}}},[e._v("\n                  终止任务\n                ")]):t("yh-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleStart(a.row)}}},[e._v("\n                  执行日志\n                ")])],1):e._e()]}}],null,!0)})],1)]}}])},[t("template",{slot:"filter-form"},[t("yh-form",{ref:"searchForm",attrs:{inline:"",model:e.search,"close-key":""}},[t("yh-form-item",{attrs:{label:"执行器",prop:"jobGroup"}},[t("yh-select",{attrs:{placeholder:"请选择",filterable:""},on:{change:e.handleChangeJobGroup},model:{value:e.search.jobGroup,callback:function(t){e.$set(e.search,"jobGroup",t)},expression:"search.jobGroup"}},e._l(e.jobGroups,(function(e){return t("yh-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1)],1),e._v(" "),t("yh-form-item",{attrs:{label:"任务",prop:"jobId"}},[t("yh-select",{attrs:{placeholder:"请选择",filterable:""},on:{change:e.handleSearchData},model:{value:e.search.jobId,callback:function(t){e.$set(e.search,"jobId",t)},expression:"search.jobId"}},e._l(e.jobIds,(function(e){return t("yh-option",{key:e.id,attrs:{label:e.jobDesc,value:e.id}})})),1)],1),e._v(" "),t("yh-form-item",{attrs:{label:"状态",prop:"logStatus"}},[t("yh-select",{attrs:{placeholder:"请选择"},on:{change:e.handleSearchData},model:{value:e.search.logStatus,callback:function(t){e.$set(e.search,"logStatus",t)},expression:"search.logStatus"}},e._l(e.logStatus,(function(e){return t("yh-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),t("yh-form-item",{attrs:{label:"调度时间",prop:"time"}},[t("yh-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right",clearable:!1},on:{change:e.handleChangeTime},model:{value:e.search.time,callback:function(t){e.$set(e.search,"time",t)},expression:"search.time"}})],1)],1)],1),e._v(" "),t("template",{slot:"filter-btns"},[t("yh-button",{attrs:{size:"mini"},on:{click:e.handleResetSearch}},[e._v("\n          重置\n        ")]),e._v(" "),t("yh-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleSearchData}},[e._v("\n          查询\n        ")])],1),e._v(" "),e._v(" "),t("template",{slot:"pagination"},[t("div",{staticClass:"fe-clear-both"},[t("yh-pagination",{staticClass:"fe-fr",attrs:{"current-page":e.search.current,"page-sizes":[15,30,45,60],"page-size":e.search.size,total:e.search.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(t){return e.$set(e.search,"current",t)},"update:current-page":function(t){return e.$set(e.search,"current",t)},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])],2),e._v(" "),t("yh-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:"日志清理",visible:e.dialogVisible,width:"480px","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("yh-form",{ref:"clearForm",staticClass:"fe-long-select",attrs:{"label-width":"80px",model:e.clearForm}},[t("yh-form-item",{attrs:{label:"执行器",readonly:"",prop:"jobGroup"}},[t("yh-select",{attrs:{placeholder:"请选择"},model:{value:e.clearForm.jobGroup,callback:function(t){e.$set(e.clearForm,"jobGroup",t)},expression:"clearForm.jobGroup"}},e._l(e.jobGroups,(function(e){return t("yh-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1)],1),e._v(" "),t("yh-form-item",{attrs:{label:"任务",readonly:"",prop:"jobId"}},[t("yh-select",{attrs:{placeholder:"请选择"},model:{value:e.clearForm.jobId,callback:function(t){e.$set(e.clearForm,"jobId",t)},expression:"clearForm.jobId"}},e._l(e.jobIds,(function(e){return t("yh-option",{key:e.id,attrs:{label:e.jobDesc,value:e.id}})})),1)],1),e._v(" "),t("yh-form-item",{attrs:{label:"清理方式",prop:"type"}},[t("yh-select",{attrs:{placeholder:"请选择"},model:{value:e.clearForm.type,callback:function(t){e.$set(e.clearForm,"type",t)},expression:"clearForm.type"}},e._l(e.clearType,(function(e){return t("yh-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("yh-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loadingFlag,expression:"loadingFlag",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.handleSaveClear}},[e._v("确定")]),e._v(" "),t("yh-button",{on:{click:e.handleClose}},[e._v("取消")])],1)],1),e._v(" "),t("yh-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:"调度日志",visible:e.logDialogVisible,width:"480px"},on:{"update:visible":function(t){e.logDialogVisible=t}}},[t("div",{domProps:{innerHTML:e._s(e.logMessage)}}),e._v(" "),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("yh-button",{attrs:{type:"primary"},on:{click:function(t){e.logDialogVisible=!1}}},[e._v("确定")])],1)])],1)],1)},o=[],r=a("a5cf"),n=a("365c"),i=a("ed08"),s={name:"ControlLogs",filters:{formateTime:function(e){return e?Object(r["parseTime"])(new Date(e)):""}},data:function(){return{pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},search:{size:15,total:0,current:1,jobGroup:0,jobId:0,logStatus:-1,time:[]},jobGroups:[],logStatus:[{label:"全部",value:-1},{label:"成功",value:1},{label:"失败",value:2},{label:"进行中",value:3}],jobIds:[],tableData:[],loadingFlag:!1,dialogVisible:!1,clearForm:{jobGroup:"",jobId:"",type:1},clearType:[{value:1,label:"清理一个月之前日志数据"},{value:2,label:"清理三个月之前日志数据"},{value:3,label:"清理六个月之前日志数据"},{value:4,label:"清理一年之前日志数据"},{value:5,label:"清理一千条以前日志数据"},{value:6,label:"清理一万条以前日志数据"},{value:7,label:"清理三万条以前日志数据"},{value:8,label:"清理十万条以前日志数据"},{value:9,label:"清理所有日志数据"}],logDialogVisible:!1,logMessage:""}},beforeRouteEnter:function(e,t,a){a((function(e){e.handleSetRouterParams()}))},methods:{handleSetRouterParams:function(){this.setDefaultTime();var e=this.$route.params,t=e.jobGroup,a=e.id;this.search.jobGroup=t||0,this.search.jobId=a||0,this.getJobGroups()},setDefaultTime:function(){this.search.time=Object(i["a"])()},handleChangeTime:function(e){e||this.setDefaultTime(),this.handleSearchData()},getJobGroups:function(){var e=this;this.loadingFlag=!0,Object(n["l"])().then((function(t){var a=t.data||{},l=a.JobGroupList;e.jobGroups=[{id:0,title:"全部"}].concat(l||[]),e.handleChangeJobGroup()})).finally((function(){e.loadingFlag=!1}))},handleChangeJobGroup:function(){var e=this;this.loadingFlag=!0,Object(n["c"])({jobGroup:this.search.jobGroup}).then((function(t){e.jobIds=[{id:0,jobDesc:"全部"}].concat(t.data||[]),e.handleSearchData()})).finally((function(){e.loadingFlag=!1}))},handleSearchData:function(){var e=this,t=JSON.parse(JSON.stringify(this.search));t.start=this.search.current-1,t.length=this.search.size,t.filterTime=this.search.time.join(" - "),this.loadingFlag=!0,Object(n["w"])(t).then((function(t){var a=t.data,l=a.data,o=a.recordsTotal;e.tableData=l||[],e.search.total=o})).finally((function(){e.loadingFlag=!1}))},handleSizeChange:function(e){this.search.size=e,this.handleSearchData()},handleCurrentChange:function(e){this.search.current=e,this.handleSearchData()},handleResetSearch:function(){this.$refs.searchForm.resetFields(),this.setDefaultTime(),this.handleSearchData()},handleClear:function(){var e=this;this.dialogVisible=!0,this.$nextTick((function(){var t=e.search,a=t.jobGroup,l=t.jobId;e.clearForm.jobGroup=a,e.clearForm.jobId=l}))},handleSaveClear:function(){var e=this;this.loadingFlag=!0,Object(n["b"])(this.clearForm).then((function(t){e.$message.success("清理成功"),e.handleClose(),e.handleSearchData()})).finally((function(){e.loadingFlag=!1}))},handleClose:function(){this.dialogVisible=!1,this.$refs.clearForm.resetFields()},getTriggerResult:function(e){return 200===e?"成功":500===e?"失败":0===e?"":e},getHandleResult:function(e){return 200===e?"成功":500===e?"失败":502===e?"失败(超时)":0===e?"":e},handleView:function(e){this.logMessage=e,this.logDialogVisible=!0},handleStop:function(e){console.log(e)},handleStart:function(e){var t=e.executorAddress,a=e.triggerTime,l=e.id,o=e.triggerCode,r=e.handleCode;this.$router.push({path:"/log-handle",query:{executorAddress:t,triggerTime:a,id:l,triggerCode:o,handleCode:r}})}}},c=s,u=(a("403c"),a("2877")),h=Object(u["a"])(c,l,o,!1,null,"7b8f1ffc",null);t["default"]=h.exports},"403c":function(e,t,a){"use strict";a("6f8c")},"6f8c":function(e,t,a){},ed08:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var l=a("a5cf"),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new Date,a=Object(l["parseTime"])(t,"{y}-{m}-{d} 23:59:59"),o=Object(l["parseTime"])(t.setDate(t.getDate()-e+1),"{y}-{m}-{d} 00:00:00");return[o,a]}}}]);